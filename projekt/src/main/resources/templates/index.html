<!-- WORK IN PROGRESS -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
</head>
<body>
<h1>Welcome!</h1>
<div th:if="${role != null}">
    Hello, <b>[[${username}]]</b> â€” your role is [[${role}]].
</div>

<p>You are logged in.</p>

<!-- Spring Security expects POST /logout (with CSRF) -->
<form th:action="@{/logout}" method="post">
    <button type="submit">Logout</button>
</form>

<!-- Ping /users -->
<button id="pingUsersBtn" type="button">Ping /users</button>
<pre id="usersOutput" style="white-space: pre-wrap; border: 1px solid #ddd; padding: .5rem; margin-top: .5rem;"></pre>

<script>
    const btn = document.getElementById('pingUsersBtn');
    const out = document.getElementById('usersOutput');

    btn.addEventListener('click', async () => {
      out.textContent = 'Loading...';
      try {
        const res = await fetch('/users', {
          headers: { 'Accept': 'application/json' }
        });

        // Read as text so we can show either JSON or an HTML error/redirect page
        const text = await res.text();

        // Pretty-print JSON if possible; otherwise show raw text
        let body = text;
        try { body = JSON.stringify(JSON.parse(text), null, 2); } catch {}

        out.textContent = `${res.status} ${res.statusText}\n` + body;
      } catch (err) {
        out.textContent = 'Request failed: ' + err;
      }
    });
</script>

</body>
</html>